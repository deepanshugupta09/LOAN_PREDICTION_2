# -*- coding: utf-8 -*-
"""job_salary_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1wh2QmC0i--ZR8f9t36IQ9UVRhqVg7fd0
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import kagglehub
import os

# Download the dataset
path = kagglehub.dataset_download("ruchi798/data-science-job-salaries")
print("Path to dataset files:", path)

# Create full CSV path dynamically
csv_path = os.path.join(path, "ds_salaries.csv")

# Load the dataset using that path
df = pd.read_csv(csv_path)

# Preview the data
df.head()

df.describe()

print("Shape of dataset:", df.shape)

# Display info (column types, missing values)
df.info()

# Summary statistics
df.describe(include='all')

df.isnull().sum()

for col in df.columns:
    print(col, ":", df[col].nunique(), "unique values")

# 1. Salary distribution
plt.figure(figsize=(8,5))
sns.histplot(df['salary_in_usd'], bins=30, kde=True)
plt.title("Distribution of Salaries (USD)")
plt.show()

plt.figure(figsize=(6,4))
sns.barplot(x='experience_level', y='salary_in_usd', data=df, estimator='mean', errorbar=None)
plt.title("Average Salary by Experience Level")
plt.show()

top_jobs = df['job_title'].value_counts().head(10).index
plt.figure(figsize=(10,5))
sns.barplot(x='job_title', y='salary_in_usd', data=df[df['job_title'].isin(top_jobs)], estimator='mean', errorbar=None)
plt.title("Average Salary by Top 10 Job Titles")
plt.xticks(rotation=45)
plt.show()

top_jobs = df['job_title'].value_counts().head(10).index
plt.figure(figsize=(10,5))
sns.barplot(x='job_title', y='salary_in_usd', data=df[df['job_title'].isin(top_jobs)], estimator='mean', errorbar=None)
plt.title("Average Salary by Top 10 Job Titles")
plt.xticks(rotation=45)
plt.show()

top_jobs = df['job_title'].value_counts().head(10).index
plt.figure(figsize=(10,5))
sns.barplot(x='job_title', y='salary_in_usd', data=df[df['job_title'].isin(top_jobs)], estimator='mean', errorbar=None)
plt.title("Average Salary by Top 10 Job Titles")
plt.xticks(rotation=45)
plt.show()

plt.figure(figsize=(8,5))
sns.boxplot(x='company_size', y='salary_in_usd', data=df)
plt.title("Salary Distribution by Company Size")
plt.show()

plt.figure(figsize=(8,5))
sns.barplot(x='remote_ratio', y='salary_in_usd', data=df, estimator='mean', errorbar=None)
plt.title("Average Salary by Remote Ratio")
plt.show()

numeric_cols = df.select_dtypes(include='number').columns
plt.figure(figsize=(6,5))
sns.heatmap(df[numeric_cols].corr(), annot=True, cmap='coolwarm', fmt=".2f")
plt.title("Correlation Heatmap")
plt.show()

from sklearn.preprocessing import LabelEncoder, OneHotEncoder

df.select_dtypes(include='object').columns

le = LabelEncoder()
for col in ['experience_level', 'employment_type', 'company_size']:
  df[col] = le.fit_transform(df[col])

df = pd.get_dummies(df, columns=['job_title', 'company_location'], drop_first=True)

def get_work_type(x):
    if x == 0:
        return 'Onsite'
    elif x == 50:
        return 'Hybrid'
    else:
        return 'Remote'

df['work_type'] = df['remote_ratio'].apply(get_work_type)

continent_map = {
    'US': 'North America', 'CA': 'North America',
    'IN': 'Asia', 'JP': 'Asia', 'CN': 'Asia',
    'GB': 'Europe', 'DE': 'Europe', 'FR': 'Europe',
    'AU': 'Oceania', 'BR': 'South America', 'ZA': 'Africa'
}

df['continent'] = df['employee_residence'].map(continent_map)

df['continent'] = le.fit_transform(df['continent'].astype(str))

df.head()

df = df.drop(columns=["Unnamed: 0"])

X = df.drop(columns=['salary_in_usd'])
Y = df["salary_in_usd"]

from sklearn.model_selection import train_test_split
x_train , x_test , y_train , y_test = train_test_split(X , Y ,test_size=0.2,random_state = 42)

from sklearn.compose import ColumnTransformer
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error, r2_score

categorical_cols = X.select_dtypes(include='object').columns

ct = ColumnTransformer(
    transformers=[
        ('encoder', OneHotEncoder(handle_unknown='ignore'), categorical_cols)
    ],
    remainder='passthrough'
)

model = RandomForestRegressor(random_state=42)
model.fit(ct.fit_transform(x_train), y_train)

y_pred = model.predict(ct.transform(x_test))

mse = mean_squared_error(y_test, y_pred)
r2 = r2_score(y_test, y_pred)

print(f"Mean Squared Error: {mse:.2f}")
print(f"RÂ² Score: {r2:.2f}")

feature_names = ct.get_feature_names_out()
importances = model.feature_importances_

sorted_idx = np.argsort(importances)[::-1]
for i in sorted_idx[:10]:
    print(f"{feature_names[i]}: {importances[i]:.4f}")